# Apache Airflow Demo

A demonstration project for Apache Airflow 3.1.6 with Python 3.13, set up using `uv` for fast and modern Python package management.

## Purpose
This project is used to test out Apache Airflow for orchestrating and monitoring data pipelines.

## Setup Steps

### 1. Prerequisites

Ensure you have the following installed:
- `uv` (Python package manager)
- Git
- GitHub CLI (`gh`)

### 2. Initialize Git Repository

```bash
# Navigate to the project directory
cd apache-airflow-demo

# Initialize a new git repository
git init

# Rename the default branch to main
git branch -m main
```

### 3. Create GitHub Repository

```bash
# Create a public GitHub repository and add it as remote origin
gh repo create apache-airflow-demo --public --source=. --remote=origin
```

### 4. Set Up Python Environment with uv

```bash
# Initialize uv project with Python 3.13
uv init --python 3.13

# Create virtual environment
uv venv
```

Note: With `uv`, you don't need to manually activate the virtual environment. Use `uv run` to execute commands within the environment.

### 5. Install Apache Airflow

Set the Airflow home directory:

```bash
export AIRFLOW_HOME=~/airflow
```

Install Apache Airflow 3.1.6 with Python 3.13 constraints:

```bash
uv add "apache-airflow==3.1.6" --constraint https://raw.githubusercontent.com/apache/airflow/constraints-3.1.6/constraints-3.13.txt
```

### 6. Verify Installation

```bash
# Check Airflow version using uv run
uv run airflow version
```

You should see: `3.1.6`

## Running Airflow

### Quick Start with Standalone Mode (Recommended)

The easiest way to get Airflow up and running is to use standalone mode, which automatically:
- Initializes the database
- Creates an admin user
- Starts the webserver and scheduler

```bash
# Set Airflow home directory (add to your shell profile to persist)
export AIRFLOW_HOME=~/airflow

# Initialize database
uv run airflow db migrate

# Start Airflow in standalone mode
uv run airflow standalone
```

On first run, Airflow will:
1. Create an admin user with auto-generated credentials
2. Display the username and password in the terminal output
3. Start the webserver on `http://localhost:8080`

**Important:** Copy the admin credentials from the terminal output and store them in your `.env` file:

```bash
# .env file format
AIRFLOW_ADMIN_USERNAME=admin
AIRFLOW_ADMIN_PASSWORD=your_generated_password
```

### Stopping Airflow

To stop all Airflow processes:

```bash
pkill -f "airflow standalone"
```

### Manual Setup (Alternative)

If you prefer to run components separately:

1. **Initialize the database:**
   ```bash
   uv run airflow db migrate
   ```

2. **Start the webserver:**
   ```bash
   uv run airflow webserver --port 8080
   ```

3. **Start the scheduler (in a new terminal):**
   ```bash
   uv run airflow scheduler
   ```

Note: In Airflow 3.x, user management is handled differently. Use standalone mode for automatic admin user creation.

### Accessing Airflow

Open your browser and navigate to `http://localhost:8080`

Log in with the credentials from your `.env` file.

## Project Structure

```
apache-airflow-demo/
├── .git/                # Git repository
├── .venv/              # Virtual environment (created by uv)
├── .env                # Environment variables (not tracked by git)
├── .env.example        # Environment variables template
├── .gitignore          # Git ignore rules
├── .python-version     # Python version specification (3.13)
├── pyproject.toml      # Project configuration and dependencies
├── uv.lock             # Locked dependency versions
├── main.py             # Main Python file
└── README.md           # This file
```

## Environment Variables

The project uses a `.env` file to store sensitive configuration. Copy `.env.example` to `.env` and update with your credentials:

```bash
cp .env.example .env
```

The `.env` file should contain:
- `AIRFLOW_ADMIN_USERNAME` - Admin username
- `AIRFLOW_ADMIN_PASSWORD` - Admin password (generated by `airflow standalone`)
- `AIRFLOW_HOME` - Airflow home directory
- `AIRFLOW__WEBSERVER__BASE_URL` - Webserver URL

## Configuration

- **Python Version:** 3.13
- **Airflow Version:** 3.1.6
- **Airflow Home:** `~/airflow`
- **Package Manager:** uv
- **Constraints:** Python 3.13 constraint file from Apache Airflow

## Resources

- [Apache Airflow Documentation](https://airflow.apache.org/docs/apache-airflow/stable/)
- [uv Documentation](https://github.com/astral-sh/uv)
- [GitHub Repository](https://github.com/StephanusSteyn/apache-airflow-demo)
